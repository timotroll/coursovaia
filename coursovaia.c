#include <stdio.h>    // Стандартный ввод-вывод: printf, scanf
#include <stdlib.h>   // Стандартная библиотека: malloc, free, exit

// Структура узла стека: каждый элемент содержит целочисленное значение (data) 
// и указатель на следующий узел.
typedef struct StackNode {
    int data;                  // Поле для хранения значения элемента стека
    struct StackNode* next;    // Указатель на следующий элемент (узел) стека
} StackNode;

// Функция создания нового узла стека
// Аргумент: значение (int), которое будет лежать в новом узле
// Возвращает: указатель на созданный узел или завершает программу при ошибке выделения памяти.
StackNode* createNode(int data) {
    StackNode* newNode = (StackNode*)malloc(sizeof(StackNode)); // Выделяем память под новый узел
    if (!newNode) {                                             // Проверяем успех выделения памяти
        printf("Ошибка выделения памяти под узел стека!\n");
        exit(EXIT_FAILURE);                                      // Завершаем программу при неудаче
    }
    newNode->data = data;   // Инициализируем значение узла
    newNode->next = NULL;   // Изначально следующий узел отсутствует
    return newNode;         // Возвращаем указатель на новый узел
}

// Функция проверки, пуст ли стек
// Аргумент: указатель на вершину стека
// Возвращает: 1, если стек пуст (top == NULL), иначе 0
int isEmpty(StackNode* top) {
    return (top == NULL);
}

// Функция push: добавляет новый элемент на вершину стека
// Аргументы: 
//  - topRef: адрес указателя на вершину стека (StackNode**), 
//    чтобы при добавлении нового узла вершина могла измениться.
//  - data: значение, которое нужно добавить в стек.
void push(StackNode** topRef, int data) {
    StackNode* newNode = createNode(data); // Создаем новый узел стека
    newNode->next = *topRef;               // Новый узел теперь указывает на бывшую вершину
    *topRef = newNode;                     // Смещаем вершину стека на новый узел
    // Теперь новый элемент - верхний в стеке
}

// Функция pop: удаляет верхний элемент стека и возвращает его значение
// Аргумент: указатель на указатель вершины стека
// Возвращает: значение удалённого элемента или -1, если стек пуст
int pop(StackNode** topRef) {
    if (isEmpty(*topRef)) {                         // Если стек пуст
        printf("Невозможно извлечь элемент: стек пуст.\n");
        return -1;                                  // Возвращаем -1 как сигнал ошибки
    }
    StackNode* temp = *topRef;      // Запоминаем текущую вершину
    int poppedValue = temp->data;   // Сохраняем значение извлекаемого элемента
    *topRef = (*topRef)->next;      // Сдвигаем вершину стека на следующий узел
    free(temp);                     // Освобождаем память под бывшую вершину
    return poppedValue;             // Возвращаем значение извлеченного элемента
}

// Функция peek: позволяет посмотреть значение верхнего элемента стека без его удаления
// Аргумент: указатель на вершину стека
// Возвращает: значение верхнего элемента или -1, если стек пуст
int peek(StackNode* top) {
    if (isEmpty(top)) {             // Проверяем, пуст ли стек
        printf("Стек пуст. Нет верхнего элемента.\n");
        return -1;                  // Возвращаем -1 как сигнал отсутствия элемента
    }
    return top->data;               // Возвращаем значение верхнего элемента
}

// Функция printStack: выводит все элементы стека на экран
// Аргумент: указатель на вершину стека (константный, так как не меняем стек)
// Выводит: значения элементов стека, начиная с вершины
void printStack(StackNode* top) {
    if (isEmpty(top)) {                         // Если стек пуст
        printf("Стек пуст.\n");
        return;
    }
    StackNode* current = top;                   // Временный указатель для обхода
    printf("Содержимое стека (верх - слева): ");
    while (current != NULL) {                   // Идем по стеку пока не дойдем до конца
        printf("%d ", current->data);           // Выводим значение текущего элемента
        current = current->next;                // Переходим к следующему элементу
    }
    printf("\n");                               // Перенос строки после вывода
}

// Функция stackSize: возвращает количество элементов в стеке
// Аргумент: указатель на вершину стека
// Возвращает: число элементов в стеке (int)
int stackSize(StackNode* top) {
    int size = 0;                 // Счетчик элементов
    StackNode* current = top;     // Временный указатель для прохода по стеку
    while (current) {             // Пока не дошли до конца стека
        size++;                   // Увеличиваем счетчик
        current = current->next;  // Переходим к следующему узлу
    }
    return size;
}

// Пример основной функции main, демонстрирующей работу со стеком.
// Здесь мы:
//  - Инициализируем стек
//  - Добавляем элементы (push)
//  - Просматриваем верхний элемент (peek)
//  - Извлекаем элементы (pop)
//  - Проверяем размер стека
//  - Выводим содержимое стека в разные моменты работы
int main() {
    // Изначально стек пуст
    StackNode* stackTop = NULL;   // Указатель на вершину стека

    // Добавим несколько элементов
    push(&stackTop, 10);
    push(&stackTop, 20);
    push(&stackTop, 30);
    push(&stackTop, 40);

    // Выведем текущее состояние стека
    printStack(stackTop);

    // Посмотрим размер стека
    printf("Текущий размер стека: %d\n", stackSize(stackTop));

    // Посмотрим верхний элемент
    int topElement = peek(stackTop);
    if (topElement != -1) {
        printf("Верхний элемент стека: %d\n", topElement);
    }

    // Извлечем несколько элементов, смотрим как изменяется стек
    int popped = pop(&stackTop);
    if (popped != -1) {
        printf("Извлечен элемент: %d\n", popped);
        printStack(stackTop);
    }

    popped = pop(&stackTop);
    if (popped != -1) {
        printf("Извлечен элемент: %d\n", popped);
        printStack(stackTop);
    }

    // Посмотрим, что теперь на вершине
    topElement = peek(stackTop);
    if (topElement != -1) {
        printf("Новый верхний элемент: %d\n", topElement);
    }

    // Извлечем оставшиеся элементы
    pop(&stackTop);
    pop(&stackTop);

    // Попытка извлечь из пустого стека
    pop(&stackTop);

    // Посмотрим, пуст ли стек
    if (isEmpty(stackTop)) {
        printf("Стек теперь пуст.\n");
    }

    return 0; // Успешное завершение программы
}
